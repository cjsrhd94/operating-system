## 5. 인터럽트
### 인터럽트란?
- 프로그램을 실행하는 도중 예외상황이 발생하여 처리가 필요할 경우에 CPU에 알려서 우선적으로 처리할 수 있게 하는 것이다.

### 인터럽트가 필요한 이유?
1. **선점형 스케쥴러 구현을 위해**
    - 프로세스 Running 중에 스케쥴러가 다른 프로세스로 교체하려면 현재 프로세스 실행을 중단시켜야한다.


2. **I/O Device와 커뮤니케이션**
    - 입출력 연산이 CPU 명령 수행속도보다 훨씬 느리다.
    - 따라서 저장매체에서 데이터 처리 완료시, 프로세스를 호출해주는 것이 효율이 좋다.
    - ex) 파일 처리가 끝났을 때 운영체제에 알려준다
   

3. **예외상황 핸들링을 위해**

### 인터럽트의 종류
1. **내부 인터럽트**
    - Trap이라고 부르며, 주로 프로그램 내부에서 잘못된 명령 또는 잘못된 데이터 사용시 발생한다.
    - ex) 0으로 나눴을 때, 사용자 모드에서 허용하지 않은 명령 또는 공간 접근시, 계산결과가 Overflow, Underflow날 때
   

2. **외부 인터럽트**
    - 주로 하드웨어에서 발생되는 이벤트 (프로그램 외부)
    - ex) 전원 이상, 기계 문제, 키보드 등 I/O 관련 이벤트, Timer 이벤트

3. **SVC(SuperVisor Call) 인터럽트**
    - 주로 프로그램 처리 중 명령의 요청에 의해 발생한 것
    - ex) 소프트웨어 이용 중에 다른 프로세스를 실행시킬 때 발생하는 자원 할당 동작

### 인터럽트 처리 과정
1. **인터럽트 요청**


2. **프로그램 실행 중단**
   - 현재 수행중인 명령이 완료된 시점에서 중단된다.


3. **현재 실행중인 프로그램 상태 보관**
   - Interrupt Vector를 읽어 ISR(Interrupt Service Routine) 주소값을 얻어 점프한다.
   - 이와 동시에 서비스를 완료하고 복귀하기 위해 다음 실행 명령의 번지를 PC(Program Counter)에 전달하여 스택에 저장한다.


4. **인터럽트 서비스 루틴 처리**
   - 서비스 루틴 수행 중, 우선순위가 더 높은 인터럽트가 발생하면 재귀적으로 1~5 과정 수행한다.


5. **상태 복구**
   - ISR이 끝나고 IRET 명령어가 실행되면 스택에 저장한 PC 값을 복원하여 이전 실행 위치로 복원하고 인터럽트를 해제한다.
   
   
### 인터럽트 우선순위
- 전원이상 인터럽트 > 기계고장 인터럽트 > 외부 인터럽트 > 입출력 인터럽트 > 프로그램 검사 인터럽트 > SVC

#### 우선순위 판별 방법
1. **폴링(Polling)**
   - 인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트 자원을 찾아 알맞는 ISR을 수행하는 소프트웨어적인 방법이다. 
   - 인터럽트를 조사하는 비용이 들어 반응시간이 느리지만, 하드웨어를 추가할 필요가 없어 회로가 간단하다는 장점이 있다.
   

2. **데이지 체인(Daisy Chain)**
   - 인터럽트가 발생했는지 확인하는 회로를 직렬로 연결하는 하드웨어적인 방법이다. 
   - 우선순위에 따라 한줄로 연결한다.
   

3. **병렬 우선순위 부여(Parallel)**
   - 인터럽트가 발생했는지 확인하는 회로를 각 장치마다 별개의 회선으로 연결하는 하드웨어적 방법이다.
   - 우선 순위가 낮은 인터럽트를 처리하는 중에도 우선순위가 높은 인터럽트를 먼저 처리할 수 있다.